<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example with a side menu that hides on mobile, just like the Pure website.">
    <title>Responsive Side Menu &ndash; Layout Examples &ndash; Pure</title>
    
    <link rel="stylesheet" href="https://unpkg.com/purecss@0.6.0/build/pure-min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css">
  <!--[if lte IE 8]>
    <link rel="stylesheet" href="/main.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/main.css">
  <!--<![endif]-->
</head>
<body onload="load()">

<div class="header">
    <div class="home-menu pure-menu pure-menu-horizontal pure-menu-fixed">
        <a class="pure-menu-heading" href="">Bookdown</a>

        <ul class="pure-menu-list">
            <li class="pure-menu-item"><a href="#" class="pure-menu-link" onclick="showBox(viewBox)">View</a></li>
            <li class="pure-menu-item"><a href="#" class="pure-menu-link" onclick="showBox(editBox)">Edit</a></li>
            <li class="pure-menu-item"><a href="#" class="pure-menu-link" onclick="save()">Save</a></li>
            <li class="pure-menu-item"><a href="#" class="pure-menu-link">Signup</a></li>
            <li class="pure-menu-item"><a href="#" class="pure-menu-link">Login</a></li>
        </ul>
    </div>
</div>

<div id="layout">
    <!-- Menu toggle -->
    <a href="#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>

    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading" href="README.md">{{{title}}}</a>
            <ul class="pure-menu-list">
						    {{#parts}}
						    <li class="pure-menu-item"><a href="{{{link}}}" class="pure-menu-link">{{{title}}}</a></li>
								{{/parts}}
            </ul>
        </div>
    </div>

    <div id="main">
			<div class="content" id="viewBox">
			  {{{html}}}
			</div>
			<div class="content" id="editBox">
			  <br/>
			  <textarea id="md" name="md">{{{md}}}</textarea>
			</div>
    </div>
</div>
<script>
var viewBox = document.getElementById("viewBox");
var editBox = document.getElementById("editBox");
var mdBox   = document.getElementById("md");
var formEdit= document.getElementById("formEdit");
var book    = "{{{book}}}", file= "{{{file}}}";

function showBox(box) {
  viewBox.style.display = 'none';
  editBox.style.display = 'none';
	box.style.display = 'block';
}

function texRender(text) {
  var tex1 = text.replace(/\$\$\s*\n\s*([^$]+)\s*\n\s*\$\$/gi, function(flag,match,end){
		return katex.renderToString(match, { displayMode: true });
  });
	var tex2 = tex1.replace(/\$\$([^$]+)\$\$/gi, function(flag,match,end){
		return katex.renderToString(match);
  });
	return tex2;
}

function ajaxPost(path, msg) {
  console.log("ajaxPost(%s, %s)", path, msg);
  var r = new XMLHttpRequest();
  r.open("POST", "/save/"+book+"/"+file, true);
  r.onreadystatechange = function () {
    if (r.readyState != 4 || r.status != 200) return;
    alert("Success: " + r.responseText);
  };
  r.send(msg);
}

function save() {
 ajaxPost('/save/'+book+'/'+file, mdBox.value);
}

function load() {
	viewBox.innerHTML = texRender(viewBox.innerHTML);
}

showBox(viewBox);
</script>
<script src="/js/ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js"></script>

</body>
</html>
